name: Development CI Pipeline

# Trigger on pushes to development branch
on:
  push:
    branches:
      - development

jobs:
  build-and-seo:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4

      # Step 2: Set up Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      # Step 3: Build all dev containers using docker-compose
      - name: Build dev containers
        run: |
          docker compose -f docker-compose.dev.yml build

      # Step 4: Generate static pages and sitemap inside frontend container
      - name: Generate static pages & sitemap
        run: |
          docker compose -f docker-compose.dev.yml run --rm frontend node generate-pages.js
          docker compose -f docker-compose.dev.yml run --rm frontend node generate-sitemap.js

      # Step 5: Run SEO audit container
      - name: Run SEO audit
        run: |
          docker compose -f docker-compose.dev.yml run --rm seo_audit

      # Step 6: Upload SEO report artifact
      - name: Upload SEO audit report
        uses: actions/upload-artifact@v4
        with:
          name: seo-report
          path: seo_audit/reports/
